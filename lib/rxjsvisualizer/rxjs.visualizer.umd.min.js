!function(e,t){"function"==typeof define&&define.amd?define(["rxjs","rxjs/operators"],t):"object"==typeof exports?module.exports=t(require("rxjs"),require("rxjs/operators")):(e.returnExports=t(e.rxjs,e.rxjs.operators),e.RxJsVisualizer=e.returnExports)}(this,(e,t)=>{const o=e,{Subject:n}=e;e.operators||(e.operators=t);const{concatMap:i,map:r,take:l,delay:s,share:a}=e.operators,c="1.0.0",d="2019-11-12";class h{static register(e,t){h.flyweights||(h.flyweights=new Map),!h.flyweights.has(e)&&t instanceof g&&h.flyweights.set(e,t)}static get(e){return h.flyweights.has(e)?this.flyweights.get(e):(console.error(`No shape '${e}' registered in ShapeFactory!`),null)}static getRegisteredShapeNames(){return[...h.flyweights.keys()]}}class g{drawImpl(e,t,o){console.error(`*** RxVis ***: method drawImpl not implemented for class ${this.__proto__.constructor.name}`)}draw(e,t,o,n,i){const r=e.fillStyle,l=e.strokeStyle,s=e.lineWidth,a=i?"stroke":"fill";e[`${a}Style`]=n,e.beginPath(),this.drawImpl(e,t,o-1,n),e.closePath(),e[a](),e.fillStyle=r,e.strokeStyle=l,e.lineWidth=s}static set width(e){g.w=e}}g.w=20;h.register("circle",new class extends g{drawImpl(e,t,o){const n=g.w/2;e.arc(t+n,o-n,n,0,2*Math.PI,!1)}});h.register("square",new class extends g{drawImpl(e,t,o){e.moveTo(t,o),e.lineTo(t,o-g.w),e.lineTo(t+g.w,o-g.w),e.lineTo(t+g.w,o),e.lineTo(t,o)}});h.register("triangle",new class extends g{drawImpl(e,t,o){e.moveTo(t,o),e.lineTo(t+g.w/2,o-g.w),e.lineTo(t+g.w,o),e.lineTo(t,o)}});h.register("diamond",new class extends g{drawImpl(e,t,o){e.moveTo(t,o-g.w/2),e.lineTo(t+g.w/2,o-g.w),e.lineTo(t+g.w,o-g.w/2),e.lineTo(t+g.w/2,o),e.lineTo(t,o-g.w/2)}});h.register("cross",new class extends g{drawImpl(e,t,o){const n=g.w/3;e.moveTo(t,o-n),e.lineTo(t,o-2*n),e.lineTo(t+n,o-2*n),e.lineTo(t+n,o-g.w),e.lineTo(t+2*n,o-g.w),e.lineTo(t+2*n,o-2*n),e.lineTo(t+g.w,o-2*n),e.lineTo(t+g.w,o-n),e.lineTo(t+2*n,o-n),e.lineTo(t+2*n,o),e.lineTo(t+n,o),e.lineTo(t+n,o-n),e.lineTo(t,o-n)}});h.register("rhombus",new class extends g{drawImpl(e,t,o){e.moveTo(t,o),e.lineTo(t+g.w/2,o-g.w),e.lineTo(t+g.w+g.w/2,o-g.w),e.lineTo(t+g.w,o),e.lineTo(t,o)}});h.register("octagon",new class extends g{drawImpl(e,t,o){const n=g.w/(1+Math.sqrt(2)),i=g.w/2;e.moveTo(t+i-n/2,o),e.lineTo(t,o-i+n/2),e.lineTo(t,o-i-n/2),e.lineTo(t+i-n/2,o-g.w),e.lineTo(t+i+n/2,o-g.w),e.lineTo(t+g.w,o-i-n/2),e.lineTo(t+g.w,o-i+n/2),e.lineTo(t+i+n/2,o),e.lineTo(t+i-n/2,o)}});h.register("kite",new class extends g{drawImpl(e,t,o){e.moveTo(t+g.w/2,o),e.lineTo(t,o-.75*g.w),e.lineTo(t+g.w/2,o-g.w),e.lineTo(t+g.w,o-.75*g.w),e.lineTo(t+g.w/2,o)}});h.register("x",new class extends g{drawImpl(e,t,o){const n=g.w/5;e.moveTo(t,o-n),e.lineTo(t+g.w/2-n,o-g.w/2),e.lineTo(t,o-g.w+n),e.lineTo(t+n,o-g.w),e.lineTo(t+g.w/2,o-g.w/2-n),e.lineTo(t+g.w-n,o-g.w),e.lineTo(t+g.w,o-g.w+n),e.lineTo(t+g.w/2+n,o-g.w/2),e.lineTo(t+g.w,o-n),e.lineTo(t+g.w-n,o),e.lineTo(t+g.w/2,o-g.w/2+n),e.lineTo(t+n,o),e.lineTo(t,o-n)}});h.register("mushroom",new class extends g{drawImpl(e,t,o){const n=g.w/3,i=g.w/2;e.moveTo(t+n,o),e.lineTo(t+n,o-g.w/2),e.lineTo(t+2*n,o-g.w/2),e.lineTo(t+2*n,o),e.lineTo(t+n,o),e.moveTo(t+n,o-g.w/2),e.arc(t+i,o-i,i,0,Math.PI,!0)}});let w,m;h.register("star",new class extends g{drawImpl(e,t,o){const n=g.w/6,i=g.w/2;e.moveTo(t+i,o),e.lineTo(t+i-n,o-i+n),e.lineTo(t,o-i),e.lineTo(t+i-n,o-i-n),e.lineTo(t+i,o-g.w),e.lineTo(t+i+n,o-i-n),e.lineTo(t+g.w,o-i),e.lineTo(t+i+n,o-i+n),e.lineTo(t+i,o)}});let u,p,f,T=["A","B"],y=T.length-1,x=!1;const b=[...h.getRegisteredShapeNames()];let k=0,$={headerWidth:50,marginHorizontal:5,marginVertical:40,blockHeight:50,shapeSize:20,centerShapes:!1,autoExpandCanvasWidth:!1,font:"italic 12px sans-serif",colors:["white","black","red","blue","green","cyan","violet","yellow","darkgray"],canvasId:"canvas",logDivId:"logs",maxPeriod:1e4,tickPeriod:1e3,symbolMap:{},guidelineColor:"gray",tickColor:"black",showTimeTicks:!0,addNavigationButtons:!1,DEBUG:!1};function E(){return S(new Date)}function S(e){const t=[e.getHours(),e.getMinutes(),e.getSeconds()].map(e=>e<10?`0${e}`:`${e}`).join(":");let o=`${e.getMilliseconds()}`;return`${t}${o=`.${"0".repeat(3-o.length)}${o}`}`}const v=e=>{const t=`${E()}: ${e}`;console.log(t);const o=e.startsWith("Completed")?"completed":"";W(e,o)},I=e=>{const t=`${E()}: ${e}`;console.error(t),W(e,"error")};function W(e,t){if(!p)return;const o=document.createElement("span");o.innerHTML=E(),o.classList.add("clock");const n=document.createElement("span");n.innerHTML=e,n.classList.add("msg"),t&&n.classList.add(t);const i=document.createElement("div");i.appendChild(o),i.appendChild(n),p.appendChild(i)}const D=(e,t)=>e+Math.floor(Math.random()*(t-e+1)),P={};let j=[],B=[];function C(e,t){const o=$.maxPeriod;t||(t=new Date);const n=(t-w)/o,i=u.width-$.headerWidth-2*$.marginHorizontal;return[$.headerWidth+$.marginHorizontal+n*i,$.marginVertical+e*$.blockHeight]}const N={atEnd:!1,shouldIgnoreSymbols:!1};function H(e){(e={...N,...e}).time||(e.time=new Date);let[t,o]=C(e.lineNr,e.time);j.push(e),t<=$.headerWidth||(P[e.lineNr]>0&&(t+=P[e.lineNr]*g.w),e.x=t,e.y=o,$.DEBUG&&v(`drawText ${e.text} at lineNr ${e.lineNr} --\x3e [${t}/${o}]`),z(e),e.text.startsWith("Error")&&O(t,o,"red"),e.text.startsWith("Complete")&&O(t,o,"orange"),e.text.startsWith("Complete")||e.text.startsWith("Error")||0!==P[e.lineNr]||function(e,t){$.DEBUG&&v(`line ${e}/${t} --\x3e ${e}/${$.marginVertical+2*$.blockHeight}`);m.beginPath(),m.moveTo(e,t-6),m.lineTo(e,t+6),m.strokeStyle=$.tickColor,m.lineWidth=1,m.stroke(),m.closePath()}(t,o),e.lineNr<y&&function(e,t){$.DEBUG&&v(`line ${e}/${t} --\x3e ${e}/${$.marginVertical+2*$.blockHeight}`);m.beginPath(),m.moveTo(e,t),m.lineTo(e,$.marginVertical+y*$.blockHeight),m.strokeStyle=$.guidelineColor,m.lineWidth=1,m.setLineDash([3,3]),m.stroke(),m.closePath(),m.setLineDash([])}(t,o))}function z(e){let t=e.shouldIgnoreSymbols?new Y({text:e.text}):f[e.text];if(t||(t=new Y({text:e.text})),t.useImage){const o=new Image;o.onload=t=>m.drawImage(o,e.x,e.y-$.shapeSize-1,$.shapeSize,$.shapeSize),o.src=t.imageUrl}else if(t.useText){const o=m.fillStyle;m.fillStyle=t.color,m.fillText(t.text,e.x+1,e.atEnd?e.y+15:e.y-2),m.fillStyle=o}else{const o=h.get(t.shape),n=$.centerShapes?e.x-$.shapeSize/2:e.x;o&&o.draw(m,n,e.y,t.color,t.strokeOnly)}}function O(e,t,o){$.DEBUG&&v(`line ${e}/${t} --\x3e ${e}/${$.marginVertical+2*$.blockHeight}`),m.beginPath(),m.moveTo(e,t),m.lineTo(e,t+17),m.strokeStyle=o,m.lineWidth=1,m.stroke(),m.closePath()}function V(e){if(!u)return;$.autoExpandCanvasWidth&&(u.width=window.innerWidth-3*$.marginHorizontal),u.height=(T.length-1)*$.blockHeight+2*$.marginVertical,m=u.getContext("2d"),u.width=u.width,m.font=$.font;const t=y+1;m.beginPath();for(let e=0;e<t;e++){const t=$.marginVertical+e*$.blockHeight;m.moveTo($.headerWidth,t),m.lineTo(u.width-$.marginHorizontal,t),m.stroke(),m.fillText(T[e]||"",$.marginHorizontal,t)}m.closePath(),m.fillText(`RxJsVisualizer@${c}`,u.width-130,u.height-4),$.addNavigationButtons&&_(),e&&function(){const e=o.timer(0,50).subscribe(t=>{const o=R(),[n,i]=L(new Date),r=m.lineWidth;if(m.beginPath(),m.moveTo($.headerWidth,o),m.strokeStyle="orange",m.lineWidth=2,m.lineTo(n,o),m.stroke(),m.closePath(),m.lineWidth=r,$.showTimeTicks){let e=(new Date).getSeconds();e<U&&(e+=60),e>=U+$.tickPeriod/1e3&&(U=e%60,M(new Date))}x&&e.unsubscribe(),i>=.995&&F&&G(1e3)})}()}let U=-1;function L(e){const t=(e-w)/$.maxPeriod,o=u.width-$.headerWidth-2*$.marginHorizontal;return[$.headerWidth+$.marginHorizontal+t*o,t]}function R(){return $.marginVertical+y*$.blockHeight+.4*$.marginVertical}function M(e){const[t]=L(e);if(B.push(e),t<=$.headerWidth)return;m.font="italic 9px sans-serif";const o=S(e).substr(3,5);m.fillText(o,t-12,R()+9);const n=R(),i=m.lineWidth;m.beginPath(),m.moveTo(t,n),m.strokeStyle="orange",m.lineWidth=2,m.lineTo(t,n-3),m.stroke(),m.closePath(),m.lineWidth=i,m.font=$.font}function G(e){w=new Date(w.getTime()+e),V(!1);const t=[...j];j=[],t.forEach(e=>H(e));const o=[...B];B=[],o.forEach(e=>M(e))}let F=!0;function _(){m.clearRect(0,u.height-17,52,u.height);const e=m.strokeStyle,t=m.lineWidth,o=m.fillStyle,n=m.font;m.fillStyle="gray",m.strokeStyle="black",m.font="italic 24px sans-serif",A("<",1,17),A(F?"x":"o",18,17,2,3),A(">",35,17),m.font=n,m.fillStyle=o,m.strokeStyle=e,m.lineWidth=t,u.onclick=e=>{const[t,o]=function(e){const t=u.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top;return[o,n]}(e);o<u.height-1-17||t>52||(t<17?($.DEBUG&&console.log("   back"),G(-1e3)):t<34?(F=!F,$.DEBUG&&console.log(`   toggleScrolling to ${F}`),_()):($.DEBUG&&console.log("   forth"),G(1e3)))}}function A(e,t,o,n=0,i=0){m.beginPath();const r=u.height-1;m.moveTo(t,r),m.lineTo(t,r-o),m.lineTo(t+o,r-o),m.lineTo(t+o,r),m.lineTo(t,r),m.closePath(),m.stroke(),m.fillText(e,t+n,u.height-i)}function J(e,t,o=!1,n){if(e>y){const t=`** RxVis **:lineNr ${e} not valid - only ${y} line${y>1?"s":""} configured`;throw I(t),t}return P[e]=0,t=t||"",{next:i=>{v(`${t} ${i}`),"function"==typeof n&&(i=n(i)),function e(t){t={...N,...t},$.DEBUG&&v(`drawObject ${JSON.stringify(t.obj)}`);const o=t.obj&&"Array"===t.obj.__proto__.constructor.name,n=isFinite(t.obj);if(o)return t.obj.forEach(o=>{t.obj=`${o}`,e(t),P[t.lineNr]++}),void(P[t.lineNr]=0);n?(t.text=`${t.obj}`,k>0&&!t.shouldIgnoreSymbols&&(t.text=`${+t.text%k}`)):t.text=`${t.obj}`,H(t)}({obj:i,lineNr:e,atEnd:!1,shouldIgnoreSymbols:o})},error:o=>{I(`Error ${t}`),H({text:"Error;red",lineNr:e,atEnd:!0}),e===y&&(x=!0)},complete:()=>{v(`Completed ${t}`),H({text:"Complete;orange",lineNr:e,atEnd:!0}),e===y&&(x=!0)}}}const q={};function X(e,t="",o=!1,n){return i=>(i.subscribe(J(e,t,o,n)),i)}q.draw=X;class Y{constructor(e){this.options={text:"",color:"black",shape:"",imageUrl:"",strokeOnly:!1},Object.keys(e).filter(t=>e.hasOwnProperty(t)).filter(e=>!this.options.hasOwnProperty(e)).forEach(e=>I(`*** DrawingSymbol ***: Unknown option '${e}' will be ignored!`)),this.options={...this.options,...e},this.text=`${this.options.text}`.trim(),this.color=this.options.color.trim(),this.shape=this.options.shape.trim(),this.imageUrl=this.options.imageUrl.trim(),this.strokeOnly=this.options.strokeOnly,this.useShape=!1,this.useText=!1,this.useImage=this.imageUrl.length>0,this.useImage||(this.shape.length>0?this.useShape=!0:this.useText=!0)}}return{init:function(e){v("**********************************************"),v(`*****        RxJsVisualizer@${c}        *****`),v(`*****   © Robert Grueneis (${d})   *****`),v("**********************************************"),Object.keys(e).filter(t=>e.hasOwnProperty(t)).filter(e=>!$.hasOwnProperty(e)).forEach(e=>I(`*** RxVis ***: Unknown option '${e}' will be ignored!`)),($={...$,...e}).DEBUG&&Object.keys($).filter(e=>$.hasOwnProperty(e)).forEach(e=>v(`RxVis '${e}' --\x3e ${$[e]}`)),g.width=$.shapeSize,v(`init with canvasId ${e.canvasId} and logDivId ${e.logDivId}`),v(`shapes: ${JSON.stringify(b)}`),v(`colors: ${JSON.stringify($.colors)}`);try{void 0!==typeof document&&(u=document.getElementById(e.canvasId)),u||(I("-------------------------------------------------------------"),I(`--- Cannot visualize - canvas with id '${e.canvasId}' not found ---`),I("-------------------------------------------------------------")),void 0!==typeof document&&(p=document.getElementById(e.logDivId)),p||(I("-------------------------------------------------------------"),I(`--- Cannot show logs - div with id '${e.logDivId}' not found ---`),I("-------------------------------------------------------------"))}catch(e){console.error("document is not defined")}(f={...$.symbolMap})["Error;red"]=new Y({text:"Error",color:"red"}),f["Complete;orange"]=new Y({text:"Complete",color:"orange"}),u&&(V(!1),function(){v("drawRegisteredShapes"),w=new Date;const[e,t]=C(0),[,o]=C(1);let n=e;b.forEach((e,i)=>{const r=$.colors[i%$.colors.length];h.get(e).draw(m,n,t,r),z({text:e,x:n,y:t,atEnd:!0,shouldIgnoreSymbols:!0}),h.get(e).draw(m,n,o,r,!0),n+=3*$.shapeSize})}())},createStreamFromArrayRandom:function(e,t=0,n=500,l=2e3){return t||(t=e.length),o.range(0,t).pipe(r(t=>D(0,e.length-1)),r(t=>e[t]),i(e=>o.of(e).pipe(s(D(n,l)))),a())},createStreamFromArraySequence:function(e,t=500,n=2e3){return o.range(0,e.length).pipe(r(t=>e[t]),i(e=>o.of(e).pipe(s(D(t,n)))),a())},createStreamFromArrayOnClick:function(e,t,o,i){const r=new n;return document.getElementById(t).addEventListener("click",t=>r.next(e[D(0,e.length-1)])),document.getElementById(o).addEventListener("click",e=>r.complete()),document.getElementById(i)&&document.getElementById(i).addEventListener("click",e=>r.error("Error")),r.asObservable()},createStreamFromSubjectOnClick:function(e,t,o,n){let i=0;return document.getElementById(t).addEventListener("click",t=>e.next(i++)),document.getElementById(o).addEventListener("click",t=>e.complete()),document.getElementById(n).addEventListener("click",t=>e.error("Error")),e.asObservable()},observerForLine:J,startVisualize:function(){p&&(p.innerHTML=""),w=new Date,U=(new Date).getSeconds(),x=!1,V(!0),j=[]},rnd:D,prepareCanvas:function(e){y=(T=e).length-1,V(!1)},writeToLine:function(e,t){v(t),H({text:t,lineNr:e,atEnd:!0})},useRandomSymbolsForNumbers:function(e=100){k>0&&0===e&&[...Array(k).keys()].forEach(e=>delete f[`${e}`]),k=e,[...Array(e).keys()].forEach(e=>{f[`${e}`]=new Y({text:`${e}`,color:$.colors[e%$.colors.length],shape:b[e%b.length]})})},operators:q,DrawingSymbol:Y,draw:X}});
